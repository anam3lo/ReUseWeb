[
  {
    "id": "welcome-message",
    "type": "function",
    "z": "chatbot-flow",
    "name": "Mensagem de Boas-vindas",
    "func": "const welcomeMsg = {\n    type: 'message',\n    content: 'üëã Ol√°! Sou o assistente da ReUse e vou te ajudar a cadastrar um novo produto para troca!\\n\\nVamos come√ßar?',\n    buttons: [\n        { text: 'Sim, vamos come√ßar! üöÄ', value: 'start_tutorial' },\n        { text: 'Preciso de ajuda geral ‚ùì', value: 'general_help' }\n    ],\n    step: 'welcome',\n    timestamp: new Date().toISOString()\n};\n\nmsg.payload = welcomeMsg;\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 350,
    "y": 40,
    "wires": [
      [
        "log-interaction",
        "send-response"
      ]
    ]
  },
  {
    "id": "user-input",
    "type": "http in",
    "z": "chatbot-flow",
    "name": "Receber Input do Usu√°rio",
    "url": "/chatbot/input",
    "method": "post",
    "upload": false,
    "swaggerDoc": "",
    "x": 150,
    "y": 120,
    "wires": [
      [
        "process-input"
      ]
    ]
  },
  {
    "id": "process-input",
    "type": "function",
    "z": "chatbot-flow",
    "name": "Processar Input",
    "func": "const userInput = msg.payload;\nconst sessionId = userInput.sessionId || 'default';\nconst message = userInput.message || '';\nconst buttonValue = userInput.buttonValue || '';\n\nlet action = '';\n\nif (buttonValue) {\n    action = buttonValue;\n} else if (message.toLowerCase().includes('voltar')) {\n    action = 'go_back';\n} else if (message.toLowerCase().includes('sair') || message.toLowerCase().includes('finalizar')) {\n    action = 'finish';\n} else if (message.toLowerCase().includes('repetir') || message.toLowerCase().includes('novamente')) {\n    action = 'repeat_step';\n} else {\n    action = 'next_step';\n}\n\nmsg.payload = {\n    sessionId: sessionId,\n    message: message,\n    action: action,\n    timestamp: new Date().toISOString()\n};\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 350,
    "y": 120,
    "wires": [
      [
        "action-router"
      ]
    ]
  },
  {
    "id": "action-router",
    "type": "switch",
    "z": "chatbot-flow",
    "name": "Roteador de A√ß√µes",
    "property": "payload.action",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "start_tutorial",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "general_help",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "finish",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 3,
    "x": 550,
    "y": 120,
    "wires": [
      [
        "step-1-title"
      ],
      [
        "general-help"
      ],
      [
        "finish-tutorial"
      ]
    ]
  },
  {
    "id": "step-1-title",
    "type": "function",
    "z": "chatbot-flow",
    "name": "Passo 1: T√≠tulo",
    "func": "const step1Msg = {\n    type: 'message',\n    content: 'üìù PASSO 1: T√çTULO DO PRODUTO\\n\\nO t√≠tulo √© o nome que aparecer√° na listagem do seu produto. Ele deve ser:\\n\\n‚úÖ Claro e descritivo\\n‚úÖ At√© 100 caracteres\\n‚úÖ Incluir marca/modelo se aplic√°vel\\n\\nExemplos bons:\\n‚Ä¢ iPhone 12 em √≥timo estado\\n‚Ä¢ Mesa de escrit√≥rio de madeira\\n‚Ä¢ Livros de programa√ß√£o React\\n\\nExemplos ruins:\\n‚Ä¢ Vendo\\n‚Ä¢ Item usado\\n‚Ä¢ Produto',\n    buttons: [\n        { text: 'Entendi! Pr√≥ximo passo ‚û°Ô∏è', value: 'step_2' },\n        { text: 'Ver exemplo novamente üîÑ', value: 'repeat_step_1' },\n        { text: 'Voltar ‚¨ÖÔ∏è', value: 'go_back' }\n    ],\n    step: 'step_1',\n    timestamp: new Date().toISOString()\n};\n\nmsg.payload = step1Msg;\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 750,
    "y": 40,
    "wires": [
      [
        "log-interaction",
        "send-response"
      ]
    ]
  },
  {
    "id": "step-2-category",
    "type": "function",
    "z": "chatbot-flow",
    "name": "Passo 2: Categoria",
    "func": "const step2Msg = {\n    type: 'message',\n    content: 'üè∑Ô∏è PASSO 2: CATEGORIA DO PRODUTO\\n\\nA categoria ajuda outros usu√°rios a encontrar seu produto facilmente.\\n\\nCategorias dispon√≠veis:\\n\\nüì± Eletr√¥nicos - Celulares, computadores, tablets\\nüëï Roupas - Vestu√°rio, cal√ßados, acess√≥rios\\nüìö Livros - Livros f√≠sicos e digitais\\nü™ë M√≥veis - Mesas, cadeiras, arm√°rios\\nüè† Casa e Jardim - Decora√ß√£o, plantas, utens√≠lios\\n‚öΩ Esportes - Equipamentos esportivos\\nüß∏ Brinquedos - Brinquedos para crian√ßas\\nüì¶ Outros - Itens que n√£o se encaixam nas categorias acima\\n\\nDica: Escolha a categoria que melhor descreve seu produto!',\n    buttons: [\n        { text: 'Entendi! Pr√≥ximo passo ‚û°Ô∏è', value: 'step_3' },\n        { text: 'Ver categorias novamente üîÑ', value: 'repeat_step_2' },\n        { text: 'Voltar ‚¨ÖÔ∏è', value: 'go_back' }\n    ],\n    step: 'step_2',\n    timestamp: new Date().toISOString()\n};\n\nmsg.payload = step2Msg;\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 750,
    "y": 120,
    "wires": [
      [
        "log-interaction",
        "send-response"
      ]
    ]
  },
  {
    "id": "step-3-description",
    "type": "function",
    "z": "chatbot-flow",
    "name": "Passo 3: Descri√ß√£o",
    "func": "const step3Msg = {\n    type: 'message',\n    content: 'üìÑ PASSO 3: DESCRI√á√ÉO DO PRODUTO\\n\\nA descri√ß√£o √© opcional, mas altamente recomendada! Ela ajuda outros usu√°rios a entender melhor seu produto.\\n\\nO que incluir na descri√ß√£o:\\n\\n‚úÖ Estado do produto (novo, usado, seminovo)\\n‚úÖ Detalhes t√©cnicos (especifica√ß√µes, modelo)\\n‚úÖ Acess√≥rios inclu√≠dos (carregador, caixa, etc.)\\n‚úÖ Motivo da troca (opcional)\\n‚úÖ Defeitos menores (se houver)\\n\\nExemplo de boa descri√ß√£o:\\n\\niPhone 12 com 128GB, sem riscos na tela, bateria com 85% de sa√∫de. Inclui carregador original, cabo USB-C e pel√≠cula de vidro. Troco porque comprei um modelo mais novo.\\n\\nDica: Seja honesto sobre o estado do produto!',\n    buttons: [\n        { text: 'Entendi! Pr√≥ximo passo ‚û°Ô∏è', value: 'step_4' },\n        { text: 'Ver exemplos novamente üîÑ', value: 'repeat_step_3' },\n        { text: 'Voltar ‚¨ÖÔ∏è', value: 'go_back' }\n    ],\n    step: 'step_3',\n    timestamp: new Date().toISOString()\n};\n\nmsg.payload = step3Msg;\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 750,
    "y": 200,
    "wires": [
      [
        "log-interaction",
        "send-response"
      ]
    ]
  },
  {
    "id": "step-4-image",
    "type": "function",
    "z": "chatbot-flow",
    "name": "Passo 4: Imagem",
    "func": "const step4Msg = {\n    type: 'message',\n    content: 'üì∏ PASSO 4: IMAGEM DO PRODUTO\\n\\nUma boa imagem aumenta muito as chances de troca!\\n\\nComo adicionar imagem:\\n\\nOp√ß√£o 1 - Upload de arquivo:\\n‚Ä¢ Clique em Upload de Arquivo\\n‚Ä¢ Selecione uma foto do seu dispositivo\\n‚Ä¢ Formatos aceitos: JPG, PNG, GIF\\n\\nOp√ß√£o 2 - URL da imagem:\\n‚Ä¢ Cole o link de uma imagem da internet\\n‚Ä¢ Certifique-se que a URL est√° funcionando\\n\\nDicas para uma boa foto:\\n\\n‚úÖ Boa ilumina√ß√£o - Evite fotos escuras\\n‚úÖ Produto em destaque - Evite fundos bagun√ßados\\n‚úÖ M√∫ltiplos √¢ngulos - Se poss√≠vel, v√°rias fotos\\n‚úÖ Mostre detalhes - Especialmente se houver defeitos\\n\\nLembre-se: A imagem √© opcional, mas produtos com foto t√™m 3x mais visualiza√ß√µes!',\n    buttons: [\n        { text: 'Entendi! Pr√≥ximo passo ‚û°Ô∏è', value: 'step_5' },\n        { text: 'Ver dicas novamente üîÑ', value: 'repeat_step_4' },\n        { text: 'Voltar ‚¨ÖÔ∏è', value: 'go_back' }\n    ],\n    step: 'step_4',\n    timestamp: new Date().toISOString()\n};\n\nmsg.payload = step4Msg;\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 750,
    "y": 280,
    "wires": [
      [
        "log-interaction",
        "send-response"
      ]
    ]
  },
  {
    "id": "step-5-final",
    "type": "function",
    "z": "chatbot-flow",
    "name": "Passo 5: Finaliza√ß√£o",
    "func": "const step5Msg = {\n    type: 'message',\n    content: 'üéâ PARAB√âNS! Voc√™ aprendeu como cadastrar um produto!\\n\\nRESUMO DO QUE APRENDEMOS:\\n\\n1Ô∏è‚É£ T√≠tulo - Claro e descritivo\\n2Ô∏è‚É£ Categoria - Escolha a mais adequada\\n3Ô∏è‚É£ Descri√ß√£o - Detalhe o estado e caracter√≠sticas\\n4Ô∏è‚É£ Imagem - Foto de qualidade (opcional)\\n\\nPR√ìXIMOS PASSOS:\\n\\n1. Acesse a p√°gina Anunciar Produto\\n2. Preencha os campos seguindo nossas dicas\\n3. Revise todas as informa√ß√µes\\n4. Clique em Anunciar Produto\\n5. Aguarde a aprova√ß√£o (se necess√°rio)\\n\\nDICAS EXTRAS:\\n\\n‚Ä¢ Seja honesto sobre o estado do produto\\n‚Ä¢ Responda mensagens de interessados rapidamente\\n‚Ä¢ Mantenha suas informa√ß√µes de contato atualizadas\\n‚Ä¢ Considere trocar por produtos de valor similar\\n\\nPrecisa de mais ajuda? Estou sempre aqui! üòä',\n    buttons: [\n        { text: 'Ir para cadastro de produto üöÄ', value: 'go_to_form' },\n        { text: 'Revisar tutorial üîÑ', value: 'restart_tutorial' },\n        { text: 'Preciso de mais ajuda ‚ùì', value: 'general_help' },\n        { text: 'Finalizar ‚úÖ', value: 'finish' }\n    ],\n    step: 'step_5',\n    timestamp: new Date().toISOString()\n};\n\nmsg.payload = step5Msg;\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 750,
    "y": 360,
    "wires": [
      [
        "log-interaction",
        "send-response"
      ]
    ]
  },
  {
    "id": "general-help",
    "type": "function",
    "z": "chatbot-flow",
    "name": "Ajuda Geral",
    "func": "const helpMsg = {\n    type: 'message',\n    content: '‚ùì AJUDA GERAL - PLATAFORMA REUSE\\n\\nO que √© a ReUse?\\nA ReUse √© uma plataforma que conecta pessoas para trocar itens usados, promovendo sustentabilidade e economia circular.\\n\\nCOMO FUNCIONA:\\n\\n1Ô∏è‚É£ Cadastre-se - Crie sua conta gratuitamente\\n2Ô∏è‚É£ Anuncie produtos - Publique itens que voc√™ n√£o usa mais\\n3Ô∏è‚É£ Procure produtos - Encontre itens que voc√™ precisa\\n4Ô∏è‚É£ Troque - Negocie trocas com outros usu√°rios\\n\\nSISTEMA DE MENSAGENS:\\n‚Ä¢ Converse diretamente com outros usu√°rios\\n‚Ä¢ Negocie detalhes da troca\\n‚Ä¢ Combine local e forma de entrega\\n\\nSEGURAN√áA:\\n‚Ä¢ Todos os usu√°rios s√£o verificados\\n‚Ä¢ Sistema de avalia√ß√µes\\n‚Ä¢ Suporte ao cliente dispon√≠vel\\n\\nCONTATO:\\n‚Ä¢ Email: suporte@reuse.com.br\\n‚Ä¢ WhatsApp: (11) 99999-9999\\n‚Ä¢ Hor√°rio: Segunda a Sexta, 9h √†s 18h',\n    buttons: [\n        { text: 'Voltar ao tutorial üìù', value: 'start_tutorial' },\n        { text: 'Preciso de suporte t√©cnico üîß', value: 'tech_support' },\n        { text: 'Finalizar ‚úÖ', value: 'finish' }\n    ],\n    step: 'general_help',\n    timestamp: new Date().toISOString()\n};\n\nmsg.payload = helpMsg;\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 750,
    "y": 80,
    "wires": [
      [
        "log-interaction",
        "send-response"
      ]
    ]
  },
  {
    "id": "finish-tutorial",
    "type": "function",
    "z": "chatbot-flow",
    "name": "Finalizar Tutorial",
    "func": "const finishMsg = {\n    type: 'message',\n    content: '‚úÖ Tutorial finalizado!\\n\\nObrigado por usar o assistente da ReUse!\\n\\nLembre-se:\\n‚Ä¢ Seja honesto sobre o estado dos produtos\\n‚Ä¢ Responda mensagens rapidamente\\n‚Ä¢ Mantenha suas informa√ß√µes atualizadas\\n\\nPrecisa de ajuda? Estou sempre aqui! üòä\\n\\nBoa sorte com suas trocas! üå±‚ôªÔ∏è',\n    buttons: [\n        { text: 'Iniciar novo tutorial üîÑ', value: 'start_tutorial' },\n        { text: 'Ir para a plataforma üöÄ', value: 'go_to_platform' }\n    ],\n    step: 'finished',\n    timestamp: new Date().toISOString()\n};\n\nmsg.payload = finishMsg;\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 750,
    "y": 320,
    "wires": [
      [
        "log-interaction",
        "send-response"
      ]
    ]
  },
  {
    "id": "log-interaction",
    "type": "function",
    "z": "chatbot-flow",
    "name": "Log de Intera√ß√£o",
    "func": "const logData = {\n    timestamp: new Date().toISOString(),\n    sessionId: msg.payload.sessionId || 'default',\n    step: msg.payload.step || 'unknown',\n    message: msg.payload.content || '',\n    type: msg.payload.type || 'message',\n    userAgent: msg.req ? msg.req.headers['user-agent'] : 'unknown',\n    ip: msg.req ? msg.req.connection.remoteAddress : 'unknown'\n};\n\nconsole.log('ü§ñ CHATBOT INTERACTION:', JSON.stringify(logData, null, 2));\n\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1050,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "send-response",
    "type": "http response",
    "z": "chatbot-flow",
    "name": "Enviar Resposta",
    "statusCode": "200",
    "headers": {
      "Content-Type": "application/json"
    },
    "x": 1050,
    "y": 40,
    "wires": []
  }
]
